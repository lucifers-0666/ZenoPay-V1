<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZenoPay Profile</title>
    <link rel="stylesheet" href="/css/dashboard.css" />
    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/profile.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Sidebar -->
    <%- include('partials/header') %>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Navigation Bar -->
      <%- include('partials/navbar') %>

      <div class="profile-container">
        <!-- Profile Header -->
        <div class="profile-header">
          <div class="profile-header-content">
            <img
              src="<%= user.ImagePath ? user.ImagePath : 'https://placehold.co/150x150?text=' + user.FullName.charAt(0) %>"
              alt="Profile"
              class="profile-avatar"
            />
            <div class="profile-info">
              <h1 class="profile-name">
                <i class="fas fa-user-circle"></i>
                <%= user.FullName %>
              </h1>
              <p class="profile-email">
                <i class="fas fa-envelope"></i>
                <%= user.Email %>
              </p>
              <div class="profile-stats">
                <% if (accountCount > 0) { %>
                <div class="stat-item">
                  <i class="fas fa-wallet"></i>
                  <div>
                    <span class="stat-label">Total Balance</span>
                    <div class="stat-balance-container">
                      <span
                        class="stat-value"
                        id="totalBalance"
                        data-balance="₹ <%= totalBalance.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>"
                        >₹ XX,XXX.XX</span
                      >
                      <button
                        class="stat-toggle-btn"
                        onclick="toggleBalance('totalBalance', 'totalBalanceIcon')"
                      >
                        <i class="fas fa-eye" id="totalBalanceIcon"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <% } %>
                <div class="stat-item">
                  <i class="fas fa-calendar-check"></i>
                  <div>
                    <span class="stat-label">Member Since</span>
                    <span class="stat-value"
                      ><%= new
                      Date(user.RegistrationDate).toLocaleDateString('en-US', {
                      month: 'short', year: 'numeric' }) %></span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="profile-tabs">
          <div class="tabs-nav">
            <button class="tab-btn active" onclick="switchTab('personal')">
              <i class="fas fa-user"></i>
              Personal Info
            </button>
            <button class="tab-btn" onclick="switchTab('accounts')">
              <i class="fas fa-university"></i>
              Bank Accounts
            </button>
            <button class="tab-btn" onclick="switchTab('cards')">
              <i class="fas fa-credit-card"></i>
              Debit Cards
            </button>
          </div>
        </div>

        <!-- Tab Content -->
        <!-- Personal Information Tab -->
        <div id="tab-personal" class="tab-content active">
          <div class="profile-section">
            <h2 class="section-title">
              <i class="fas fa-info-circle"></i>
              Complete Profile Details
            </h2>

            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-user"></i>
                  Full Name
                </div>
                <div class="info-value"><%= user.FullName %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-id-badge"></i>
                  ZenoPay ID
                </div>
                <div class="info-value"><%= user.ZenoPayID %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-envelope"></i>
                  Email Address
                </div>
                <div class="info-value"><%= user.Email %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-phone"></i>
                  Mobile Number
                </div>
                <div class="info-value"><%= user.Mobile %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-calendar-alt"></i>
                  Date of Birth
                </div>
                <div class="info-value">
                  <%= new Date(user.DOB).toLocaleDateString('en-IN') %>
                </div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-venus-mars"></i>
                  Gender
                </div>
                <div class="info-value"><%= user.Gender %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-male"></i>
                  Father's Name
                </div>
                <div class="info-value"><%= user.FatherName %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-female"></i>
                  Mother's Name
                </div>
                <div class="info-value"><%= user.MotherName || 'N/A' %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-map-marker-alt"></i>
                  Address
                </div>
                <div class="info-value"><%= user.Address %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-city"></i>
                  City
                </div>
                <div class="info-value"><%= user.City %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-map"></i>
                  State
                </div>
                <div class="info-value"><%= user.State %></div>
              </div>

              <div class="info-item">
                <div class="info-label">
                  <i class="fas fa-mailbox"></i>
                  Pincode
                </div>
                <div class="info-value"><%= user.Pincode %></div>
              </div>
            </div>

            <div class="action-buttons">
              <span class="verified-badge">
                <i class="fas fa-check-circle"></i>
                Verified Profile
              </span>
            </div>
          </div>
        </div>

        <!-- Bank Accounts Tab -->
        <div id="tab-accounts" class="tab-content">
          <div class="profile-section">
            <h2 class="section-title">
              <i class="fas fa-university"></i>
              My Bank Accounts
            </h2>

            <div class="bank-accounts-grid">
              <% if (bankAccounts && bankAccounts.length > 0) { %> <%
              bankAccounts.forEach((account, index) => { %>
              <div class="bank-card">
                <div class="bank-card-header">
                  <div class="bank-name">
                    <i class="fas fa-university"></i>
                    <%= account.BankName %>
                  </div>
                  <div
                    class="bank-status-badge <%= account.AccountStatus.toLowerCase() %>"
                  >
                    <i
                      class="fas fa-<%= account.AccountStatus === 'Active' ? 'check-circle' : 'exclamation-circle' %>"
                    ></i>
                    <%= account.AccountStatus %>
                  </div>
                </div>
                <div class="bank-card-body">
                  <div class="bank-logo-container">
                    <img
                      src="/Images/bgFavicon.png"
                      alt="ZenoPay"
                      class="bank-logo-img"
                    />
                  </div>
                  <div class="bank-account-info">
                    <div class="account-number-section">
                      <span class="account-label">Account Number</span>
                      <div class="account-number-container">
                        <span class="account-number"
                          ><%= account.AccountNumber.replace(/(.{4})/g, '$1').trim() %></span
                        >
                        <button
                          class="copy-btn"
                          onclick="copyAccountNumber('<%= account.AccountNumber %>', this)"
                        >
                          <i class="fas fa-copy"></i>
                        </button>
                      </div>
                    </div>
                    <div class="account-type-section">
                      <span class="account-label">Account Type</span>
                      <span class="account-type"
                        ><%= account.AccountType %></span
                      >
                    </div>
                  </div>
                  <div class="bank-card-actions">
                    <div class="bank-id-section">
                      <span class="bank-id-label">Bank ID</span>
                      <span class="bank-id-value"><%= account.BankId %></span>
                    </div>
                    <div class="bank-id-section">
                      <span class="bank-id-label">Branch</span>
                      <span class="bank-id-value"
                        ><%= account.BankCity %>, <%= account.BankState %></span
                      >
                    </div>
                  </div>
                  <div class="balance-container">
                    <div class="balance-label">Available Balance</div>
                    <div class="balance-amount-container">
                      <div
                        class="balance-amount"
                        id="balance<%= index + 1 %>"
                        data-balance="₹ <%= parseFloat(account.Balance.toString()).toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>"
                      >
                        ₹ XX,XXX.XX
                      </div>
                      <button
                        class="balance-toggle-btn"
                        onclick="toggleBalance('balance<%= index + 1 %>', 'balanceIcon<%= index + 1 %>')"
                      >
                        <i
                          class="fas fa-eye"
                          id="balanceIcon<%= index + 1 %>"
                        ></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <% }); %> <% } else { %>
              <div class="no-data-message">
                <i class="fas fa-inbox"></i>
                <p>No bank accounts found. Open your first account!</p>
              </div>
              <% } %>
            </div>

            <div class="action-buttons">
              <a href="/open-account" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Open New Account
              </a>
            </div>
          </div>
        </div>

        <!-- Debit Cards Tab -->
        <div id="tab-cards" class="tab-content">
          <div class="profile-section">
            <h2 class="section-title">
              <i class="fas fa-credit-card"></i>
              My Debit Cards
            </h2>

            <div class="debit-cards-container">
              <% if (bankAccounts && bankAccounts.length > 0) { %> <%
              bankAccounts.forEach((account, index) => { %>
              <div
                class="debit-card <%= index % 2 === 0 ? '' : 'debit-card-dark' %>"
              >
                <div class="card-top-section">
                  <div class="card-bank-name-top">
                    <%= account.BankName.toUpperCase() %>
                  </div>
                  <div
                    class="card-status-badge <%= account.DebitCardStatus.toLowerCase() %>"
                  >
                    <i
                      class="fas fa-<%= account.DebitCardStatus === 'Active' ? 'check-circle' : 'exclamation-circle' %>"
                    ></i>
                    <%= account.DebitCardStatus %>
                  </div>
                </div>
                <div class="card-chip">
                  <i class="fas fa-microchip"></i>
                </div>
                <div class="card-logo">
                  <img
                    src="/Images/bgFavicon.png"
                    alt="ZenoPay"
                    class="zenopay-logo-img"
                  />
                </div>
                <div class="card-number-container">
                  <div
                    class="card-number"
                    id="cardNum<%= index + 1 %>"
                    data-number="<%= account.DebitCardNumber.replace(/(.{4})/g, '$1 ').trim() %>"
                  >
                    **** **** **** <%= account.DebitCardNumber.slice(-4) %>
                  </div>
                  <button
                    class="card-toggle-btn"
                    onclick="toggleCardNumber('cardNum<%= index + 1 %>', 'cardIcon<%= index + 1 %>')"
                  >
                    <i class="fas fa-eye" id="cardIcon<%= index + 1 %>"></i>
                  </button>
                </div>
                <div class="card-details">
                  <div class="card-holder">
                    <div class="card-label">CARD HOLDER</div>
                    <div class="card-value"><%= account.NameOnCard %></div>
                  </div>
                  <div class="card-expiry">
                    <div class="card-label">VALID THRU</div>
                    <div class="card-value"><%= account.CardExpiry %></div>
                  </div>
                  <div class="card-cvv">
                    <div class="card-label">CVV</div>
                    <div class="card-cvv-container">
                      <div
                        class="card-value"
                        id="cvv<%= index + 1 %>"
                        data-cvv="<%= account.CardCVV %>"
                      >
                        ***
                      </div>
                      <button
                        class="card-cvv-btn"
                        onclick="toggleCVV('cvv<%= index + 1 %>', 'cvvIcon<%= index + 1 %>')"
                      >
                        <i class="fas fa-eye" id="cvvIcon<%= index + 1 %>"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <% }); %> <% } else { %>
              <div class="no-data-message">
                <i class="fas fa-inbox"></i>
                <p>
                  No debit cards found. Open a bank account to get your card!
                </p>
              </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Footer Navigation -->
      <footer class="mobile-footer">
        <nav class="footer-nav">
          <a href="/dashboard" class="footer-nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
          </a>
          <a href="/transfer-money" class="footer-nav-item">
            <i class="fas fa-exchange-alt"></i>
            <span>Transfer</span>
          </a>
          <a href="/profile" class="footer-nav-item active">
            <i class="fas fa-user"></i>
            <span>Profile</span>
          </a>
          <a href="/notifications" class="footer-nav-item">
            <i class="fas fa-bell"></i>
            <span>Alerts</span>
          </a>
          <a href="/shop" class="footer-nav-item">
            <i class="fas fa-shopping-cart"></i>
            <span>Shop</span>
          </a>
        </nav>
      </footer>

      <script src="/js/header.js"></script>
      <script>
        // Tab Switching Function
        function switchTab(tabName) {
          // Hide all tab contents
          const tabContents = document.querySelectorAll(".tab-content");
          tabContents.forEach((content) => {
            content.classList.remove("active");
          });

          // Remove active class from all buttons
          const tabButtons = document.querySelectorAll(".tab-btn");
          tabButtons.forEach((btn) => {
            btn.classList.remove("active");
          });

          // Show selected tab content
          document.getElementById("tab-" + tabName).classList.add("active");

          // Add active class to clicked button
          event.target.closest(".tab-btn").classList.add("active");
        }

        // Toggle Card Number Visibility
        function toggleCardNumber(cardId, iconId) {
          const cardElement = document.getElementById(cardId);
          const iconElement = document.getElementById(iconId);
          const fullNumber = cardElement.getAttribute("data-number");
          const maskedNumber = "**** **** **** " + fullNumber.slice(-4);

          if (cardElement.textContent.includes("*")) {
            cardElement.textContent = fullNumber;
            iconElement.classList.remove("fa-eye");
            iconElement.classList.add("fa-eye-slash");
          } else {
            cardElement.textContent = maskedNumber;
            iconElement.classList.remove("fa-eye-slash");
            iconElement.classList.add("fa-eye");
          }
        }

        // Toggle CVV Visibility
        function toggleCVV(cvvId, iconId) {
          const cvvElement = document.getElementById(cvvId);
          const iconElement = document.getElementById(iconId);
          const fullCVV = cvvElement.getAttribute("data-cvv");

          if (cvvElement.textContent === "***") {
            cvvElement.textContent = fullCVV;
            iconElement.classList.remove("fa-eye");
            iconElement.classList.add("fa-eye-slash");
          } else {
            cvvElement.textContent = "***";
            iconElement.classList.remove("fa-eye-slash");
            iconElement.classList.add("fa-eye");
          }
        }

        // Toggle Balance Visibility
        function toggleBalance(balanceId, iconId) {
          const balanceElement = document.getElementById(balanceId);
          const iconElement = document.getElementById(iconId);
          const actualBalance = balanceElement.getAttribute("data-balance");

          if (balanceElement.textContent.includes("XX")) {
            balanceElement.textContent = actualBalance;
            iconElement.classList.remove("fa-eye");
            iconElement.classList.add("fa-eye-slash");
          } else {
            balanceElement.textContent = "₹ XX,XXX.XX";
            iconElement.classList.remove("fa-eye-slash");
            iconElement.classList.add("fa-eye");
          }
        }

        // Copy Account Number
        function copyAccountNumber(accountNumber, button) {
          navigator.clipboard.writeText(accountNumber).then(() => {
            const icon = button.querySelector("i");
            icon.classList.remove("fa-copy");
            icon.classList.add("fa-check");
            button.style.background = "rgba(40, 167, 69, 0.4)";

            setTimeout(() => {
              icon.classList.remove("fa-check");
              icon.classList.add("fa-copy");
              button.style.background = "rgba(255, 255, 255, 0.2)";
            }, 2000);
          });
        }
      </script>
    </main>
    <%- include('partials/MobileNav') %>  </body>
</html>
