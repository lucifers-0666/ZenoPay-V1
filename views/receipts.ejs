<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %></title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/receipts.css">
</head>
<body>
  <div class="page-container">
    <header class="page-header">
      <div>
        <h1>Payment Receipts</h1>
        <p class="subtitle">View, download, and manage your transaction receipts</p>
      </div>
      <div class="view-toggle">
        <button class="toggle-btn active" data-view="grid"><i class="fas fa-th"></i></button>
        <button class="toggle-btn" data-view="list"><i class="fas fa-list"></i></button>
      </div>
    </header>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="search-input" placeholder="Search by Transaction ID, recipient, or amount" value="<%= filters.search || '' %>">
      </div>
      
      <div class="filter-group">
        <select id="type-filter" class="filter-select">
          <option value="">All Types</option>
          <option value="sent" <%= filters.type === 'sent' ? 'selected' : '' %>>Sent</option>
          <option value="received" <%= filters.type === 'received' ? 'selected' : '' %>>Received</option>
        </select>
        
        <select id="status-filter" class="filter-select">
          <option value="">All Statuses</option>
          <option value="completed" <%= filters.status === 'completed' ? 'selected' : '' %>>Completed</option>
          <option value="refunded" <%= filters.status === 'refunded' ? 'selected' : '' %>>Refunded</option>
        </select>
        
        <input type="date" id="date-from" class="filter-input" value="<%= filters.dateFrom || '' %>">
        <input type="date" id="date-to" class="filter-input" value="<%= filters.dateTo || '' %>">
      </div>

      <button class="btn btn-icon bulk-download-btn" title="Download Selected" id="bulk-download-btn" hidden>
        <i class="fas fa-download"></i>
      </button>
    </div>

    <!-- Receipts Grid -->
    <div class="receipts-container grid-view">
      <% if (receipts && receipts.length > 0) { %>
        <% receipts.forEach(receipt => { %>
        <div class="receipt-card">
          <div class="receipt-header">
            <input type="checkbox" class="receipt-checkbox" value="<%= receipt.receiptId %>">
            <span class="receipt-date"><%= new Date(receipt.date).toLocaleDateString() %></span>
            <span class="receipt-type-badge <%= receipt.type %>">
              <i class="fas fa-arrow-<%= receipt.type === 'sent' ? 'up' : 'down' %>"></i>
              <%= receipt.type %>
            </span>
          </div>

          <div class="receipt-body">
            <div class="receipt-amount <%= receipt.type %>">
              <%= receipt.type === 'sent' ? '-' : '+' %>$<%= receipt.amount.toFixed(2) %>
            </div>
            <div class="receipt-parties">
              <% if (receipt.type === 'sent') { %>
                <span class="party-label">To:</span> <%= receipt.recipientName %>
              <% } else { %>
                <span class="party-label">From:</span> <%= receipt.senderName %>
              <% } %>
            </div>
            <div class="receipt-id"><%= receipt.transactionId %></div>
            <div class="receipt-method">
              <i class="fas fa-<%= receipt.paymentMethod.type === 'card' ? 'credit-card' : 'university' %>"></i>
              <% if (receipt.paymentMethod.last4) { %>
                •••• <%= receipt.paymentMethod.last4 %>
              <% } else { %>
                <%= receipt.paymentMethod.name %>
              <% } %>
            </div>
          </div>

          <div class="receipt-footer">
            <span class="status-badge status-<%= receipt.status %>"><%= receipt.status %></span>
            <div class="receipt-actions">
              <button class="btn btn-sm view-receipt-btn" data-receipt-id="<%= receipt.receiptId %>">
                <i class="fas fa-eye"></i> View
              </button>
              <button class="btn btn-sm btn-icon download-receipt-btn" data-receipt-id="<%= receipt.receiptId %>" title="Download PDF">
                <i class="fas fa-download"></i>
              </button>
            </div>
          </div>
        </div>
        <% }); %>
      <% } else { %>
        <div class="empty-state">
          <i class="fas fa-receipt"></i>
          <h3>No Receipts Found</h3>
          <p>Your transaction receipts will appear here</p>
          <button class="btn btn-secondary" onclick="location.reload()">Refresh</button>
        </div>
      <% } %>
    </div>
  </div>

  <!-- Receipt Detail Modal -->
  <div class="modal" id="receipt-modal" hidden>
    <div class="modal-content receipt-modal-content">
      <div class="modal-header">
        <h2>Payment Receipt</h2>
        <button class="close-btn" id="close-modal">&times;</button>
      </div>
      <div class="modal-body" id="receipt-detail-content">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading receipt...</p>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" hidden></div>

  <script src="/js/receipts.js"></script>
</body>
</html>
