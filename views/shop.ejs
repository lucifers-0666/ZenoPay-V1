<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo Shop - ZenoPay Integration</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
      }

      .product-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
      }

      .product-card:hover {
        transform: translateY(-5px);
      }

      .product-image {
        width: 100%;
        height: 200px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 4em;
        margin-bottom: 20px;
      }

      .product-title {
        font-size: 1.5em;
        margin-bottom: 10px;
        color: #333;
      }

      .product-description {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.6;
      }

      .product-price {
        font-size: 2em;
        color: #667eea;
        font-weight: bold;
        margin-bottom: 20px;
      }

      .buy-button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .buy-button:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .buy-button:active {
        transform: scale(0.98);
      }

      .integration-info {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-top: 40px;
      }

      .integration-info h2 {
        color: #333;
        margin-bottom: 20px;
      }

      .integration-info pre {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 0.9em;
      }

      .api-key-section {
        background: #fff3cd;
        border: 2px solid #ffc107;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .api-key-section h3 {
        color: #856404;
        margin-bottom: 10px;
      }

      .api-key {
        background: white;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        word-break: break-all;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üõçÔ∏è Demo Shop</h1>
        <p>Experience ZenoPay Payment Gateway Integration</p>
      </div>

      <div class="products-grid">
        <div class="product-card">
          <div class="product-image">üì±</div>
          <h3 class="product-title">Smartphone X Pro</h3>
          <p class="product-description">
            Latest flagship smartphone with amazing features
          </p>
          <div class="product-price">‚Çπ45,999</div>
          <button class="buy-button" onclick="buyProduct('Smartphone X Pro', 45999, 'ORD001')">
            Buy Now
          </button>
        </div>

        <div class="product-card">
          <div class="product-image">üíª</div>
          <h3 class="product-title">Laptop Ultra</h3>
          <p class="product-description">
            Powerful laptop for professionals and creators
          </p>
          <div class="product-price">‚Çπ89,999</div>
          <button class="buy-button" onclick="buyProduct('Laptop Ultra', 89999, 'ORD002')">
            Buy Now
          </button>
        </div>

        <div class="product-card">
          <div class="product-image">üéß</div>
          <h3 class="product-title">Wireless Headphones</h3>
          <p class="product-description">
            Premium noise-cancelling wireless headphones
          </p>
          <div class="product-price">‚Çπ15,999</div>
          <button class="buy-button" onclick="buyProduct('Wireless Headphones', 15999, 'ORD003')">
            Buy Now
          </button>
        </div>
      </div>

      <div class="integration-info">
        <div class="api-key-section">
          <h3>‚ö†Ô∏è Test API Key (From your screenshot)</h3>
          <div class="api-key">
            <strong>API Key:</strong><br>
            zpk_live_c9ec6b9e9e7ac4ab7e174f53b0e7b8b879973ed919236344760397244f734f263
          </div>
        </div>

        <h2>üìò Integration Guide</h2>
        <p style="margin-bottom: 20px; color: #666;">
          This is how merchants can integrate ZenoPay into their websites:
        </p>

        <h3 style="margin-top: 20px; margin-bottom: 10px;">üéØ Razorpay-Style Integration</h3>
        
        <h4 style="margin-top: 15px;">Step 1: Include Checkout Script</h4>
        <pre>&lt;script src="https://your-zenopay-domain.com/js/checkout.js"&gt;&lt;/script&gt;</pre>

        <h4 style="margin-top: 15px;">Step 2: Create Order (Server-side)</h4>
        <pre>// On your server
const order = await fetch('https://api.zenopay.com/api/orders', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-API-Key': 'zpk_live_your_api_key'
  },
  body: JSON.stringify({
    amount: 50000, // Amount in paise (‚Çπ500)
    currency: 'INR',
    receipt: 'order_rcptid_11'
  })
});</pre>

        <h4 style="margin-top: 15px;">Step 3: Initialize Checkout (Client-side)</h4>
        <pre>const options = {
  key: 'zpk_live_your_api_key',
  amount: order.amount,
  currency: 'INR',
  name: 'Your Business Name',
  description: 'Product Description',
  order_id: order.id,
  handler: function (response) {
    // Payment success
    console.log(response.razorpay_payment_id);
    console.log(response.razorpay_order_id);
    console.log(response.razorpay_signature);
  },
  prefill: {
    name: 'Customer Name',
    email: 'customer@example.com',
    contact: '9876543210'
  },
  theme: {
    color: '#3399cc'
  }
};

const zenopay = new ZenoPay({ key: options.key });
zenopay.createPayment(options).open();</pre>

        <h4 style="margin-top: 15px;">Step 4: Verify Payment (Server-side)</h4>
        <pre>// Verify signature on your server
const verified = await fetch('https://api.zenopay.com/api/payments/verify', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-API-Key': 'zpk_live_your_api_key'
  },
  body: JSON.stringify({
    razorpay_order_id: response.razorpay_order_id,
    razorpay_payment_id: response.razorpay_payment_id,
    razorpay_signature: response.razorpay_signature
  })
});</pre>

        <h3 style="margin-top: 20px; margin-bottom: 10px;">Payment Methods Supported</h3>
        <ul style="margin-left: 20px; color: #666; line-height: 2;">
          <li>üí≥ Debit/Credit Card</li>
          <li>üì± UPI / ZenoPay ID</li>
          <li>üìû Mobile Number</li>
          <li>üìß Email (Gmail)</li>
        </ul>
      </div>
    </div>

    <!-- Load ZenoPay Checkout (Razorpay Style) -->
    <script src="/js/checkout.js"></script>
    
    <script>
      // Your API Key
      const ZENOPAY_KEY = 'zpk_live_c9ec6b9e9e7ac4ab7e174f53b0e7b8b879973ed919236344760397244f734f263';

      // Function to handle product purchase (Razorpay Style)
      async function buyProduct(productName, amount, orderId) {
        try {
          // Step 1: Create Order on Server (Razorpay style)
          const orderResponse = await fetch('/api/orders', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-API-Key': ZENOPAY_KEY
            },
            body: JSON.stringify({
              amount: amount, // Amount in INR
              currency: 'INR',
              receipt: orderId,
              notes: {
                productName: productName
              }
            })
          });

          if (!orderResponse.ok) {
            const errorData = await orderResponse.json();
            console.error('Order creation failed:', errorData);
            alert('Failed to create order: ' + (errorData.error || 'Please try again.'));
            return;
          }

          const order = await orderResponse.json();
          console.log('Order created:', order);
          
          if (!order.id) {
            alert('Failed to create order. Invalid response.');
            return;
          }

          // Step 2: Initialize ZenoPay Checkout (Razorpay style)
          const options = {
            key: ZENOPAY_KEY,
            amount: order.amount, // Amount in paise
            currency: order.currency,
            name: 'Demo Shop',
            description: `Purchase of ${productName}`,
            image: '', // Your logo URL
            order_id: order.id,
            handler: function (response) {
              // Step 3: Payment Success Handler
              console.log('Payment Response:', response);
              
              // Verify payment on server
              verifyPayment(response);
            },
            prefill: {
              name: '',
              email: '',
              contact: ''
            },
            notes: {
              productName: productName
            },
            theme: {
              color: '#667eea'
            },
            modal: {
              ondismiss: function() {
                console.log('Payment cancelled by user');
              }
            }
          };

          // Step 4: Create ZenoPay instance and open checkout
          const zenopay = new ZenoPay({ key: ZENOPAY_KEY });
          zenopay.createPayment(options).open();

        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred. Please try again.');
        }
      }

      // Step 5: Verify payment on server (Razorpay style)
      async function verifyPayment(response) {
        try {
          const verifyResponse = await fetch('/api/payments/verify', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-API-Key': ZENOPAY_KEY
            },
            body: JSON.stringify({
              razorpay_order_id: response.razorpay_order_id,
              razorpay_payment_id: response.razorpay_payment_id,
              razorpay_signature: response.razorpay_signature,
              zenopay_order_id: response.zenopay_order_id,
              zenopay_payment_id: response.zenopay_payment_id,
              zenopay_signature: response.zenopay_signature
            })
          });

          const result = await verifyResponse.json();

          if (result.success) {
            // Payment verified successfully
            alert('‚úÖ Payment Successful!\n\n' +
                  'Payment ID: ' + response.razorpay_payment_id + '\n' +
                  'Order ID: ' + response.razorpay_order_id + '\n' +
                  'Transaction ID: ' + response.zenopay_transaction_id);
            
            // Redirect or update UI
            // window.location.href = '/payment-success';
          } else {
            alert('‚ùå Payment verification failed!\n' + result.error);
          }
        } catch (error) {
          console.error('Verification error:', error);
          alert('Payment verification failed. Please contact support.');
        }
      }

      // Check if payment was successful (from callback)
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('payment') === 'success') {
        const transactionId = urlParams.get('transactionId');
        alert(`Payment Successful! Transaction ID: ${transactionId}`);
        
        // Clean URL
        window.history.replaceState({}, document.title, '/shop');
      }
    </script>
  </body>
</html>
